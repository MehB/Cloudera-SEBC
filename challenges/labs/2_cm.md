## Cloudera Manager Installation


### List of the repository files

```
[root@ip-172-31-3-220 yum.repos.d]# ls -la
total 52
drwxr-xr-x.  2 root root 4096 Mar 10 09:11 .
drwxr-xr-x. 80 root root 8192 Mar 10 08:20 ..
-rw-r--r--.  1 root root 1664 Nov 29 18:12 CentOS-Base.repo
-rw-r--r--.  1 root root 1309 Nov 29 18:12 CentOS-CR.repo
-rw-r--r--.  1 root root  649 Nov 29 18:12 CentOS-Debuginfo.repo
-rw-r--r--.  1 root root  314 Nov 29 18:12 CentOS-fasttrack.repo
-rw-r--r--.  1 root root  630 Nov 29 18:12 CentOS-Media.repo
-rw-r--r--.  1 root root 1331 Nov 29 18:12 CentOS-Sources.repo
-rw-r--r--.  1 root root 2893 Nov 29 18:12 CentOS-Vault.repo
-rw-r--r--   1 root root  294 Mar 10 09:11 cloudera-manager.repo
-rw-r--r--   1 root root  138 Mar 10 08:31 MariaDB.repo
```

### Cloudera Manager repo file
```
[cloudera-manager]
# Packages for Cloudera Manager, Version 5, on RedHat or CentOS 7 x86_64
name=Cloudera Manager
baseurl=https://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.10.0/
gpgkey =https://archive.cloudera.com/cm5/redhat/7/x86_64/cm/RPM-GPG-KEY-cloudera
gpgcheck = 1
```


### Prepare database

`/usr/share/cmf/schema/scm_prepare_database.sh mysql scm scm scm -h ip-172-31-5-225.us-west-2.compute.internal`

```
JAVA_HOME=/usr/java/jdk1.7.0_55
Verifying that we can write to /etc/cloudera-scm-server
Creating SCM configuration file in /etc/cloudera-scm-server
Executing:  /usr/java/jdk1.7.0_55/bin/java -cp /usr/share/java/mysql-connector-java.jar:/usr/share/java/oracle-connector-java.jar:/usr/share/cmf/schema/../lib/* com.cloudera.enterprise.dbutil.DbCommandExecutor /etc/cloudera-scm-server/db.properties com.cloudera.cmf.db.
[                          main] DbCommandExecutor              INFO  Successfully connected to database.
All done, your SCM database is configured correctly!
```



### Start Cloudera Manager Server

```
# service cloudera-scm-server start
Starting cloudera-scm-server (via systemctl):              [  OK  ]
```

### Status

```
[root@ip-172-31-3-220 yum.repos.d]# service cloudera-scm-server status
/etc/init.d/cloudera-scm-server: line 109: pstree: command not found
‚óè cloudera-scm-server.service - LSB: Cloudera SCM Server
   Loaded: loaded (/etc/rc.d/init.d/cloudera-scm-server; bad; vendor preset: disabled)
   Active: active (exited) since Fri 2017-03-10 09:24:41 UTC; 5s ago
     Docs: man:systemd-sysv-generator(8)
  Process: 13209 ExecStart=/etc/rc.d/init.d/cloudera-scm-server start (code=exited, status=0/SUCCESS)

Mar 10 09:24:36 ip-172-31-3-220.us-west-2.compute.internal systemd[1]: Starting LSB: Cloudera SCM Server...
Mar 10 09:24:36 ip-172-31-3-220.us-west-2.compute.internal cloudera-scm-server[13209]: /etc/rc.d/init.d/cloudera-scm-server: line 109: pstree: command not found
Mar 10 09:24:36 ip-172-31-3-220.us-west-2.compute.internal su[13231]: (to cloudera-scm) root on none
Mar 10 09:24:41 ip-172-31-3-220.us-west-2.compute.internal cloudera-scm-server[13209]: Starting cloudera-scm-server: [  OK  ]
Mar 10 09:24:41 ip-172-31-3-220.us-west-2.compute.internal systemd[1]: Started LSB: Cloudera SCM Server.

```


### First line of the Cloudera Manager Server Login

```
# head -1 /var/log/cloudera-scm-server/cloudera-scm-server.log
2017-03-10 09:24:37,161 INFO main:com.cloudera.server.cmf.Main: Starting SCM Server. JVM Args: [-Dlog4j.configuration=file:/etc/cloudera-scm-server/log4j.properties, -Dfile.encoding=UTF-8, -Dcmf.root.logger=INFO,LOGFILE, -Dcmf.log.dir=/var/log/cloudera-scm-server, -Dcmf.log.file=cloudera-scm-server.log, -Dcmf.jetty.threshhold=WARN, -Dcmf.schema.dir=/usr/share/cmf/schema, -Djava.awt.headless=true, -Djava.net.preferIPv4Stack=true, -Dpython.home=/usr/share/cmf/python, -XX:+UseConcMarkSweepGC, -XX:+UseParNewGC, -XX:+HeapDumpOnOutOfMemoryError, -Xmx2G, -XX:MaxPermSize=256m, -XX:+HeapDumpOnOutOfMemoryError, -XX:HeapDumpPath=/tmp, -XX:OnOutOfMemoryError=kill -9 %p], Args: [], Version: 5.10.0 (#85 built by jenkins on 20170120-1037 git: aa0b5cd5eceaefe2f971c13ab657020d96bb842a)
```


### Jessy Server log

```
# grep "Started Jetty server" /var/log/cloudera-scm-server/cloudera-scm-server.log
2017-03-10 09:25:54,808 INFO WebServerImpl:com.cloudera.server.cmf.WebServerImpl: Started Jetty server.
```

### DB properties file

```
# cat /etc/cloudera-scm-server/db.properties
# Auto-generated by scm_prepare_database.sh on Fri Mar 10 09:21:26 UTC 2017
#
# For information describing how to configure the Cloudera Manager Server
# to connect to databases, see the "Cloudera Manager Installation Guide."
#
com.cloudera.cmf.db.type=mysql
com.cloudera.cmf.db.host=ip-172-31-5-225.us-west-2.compute.internal
com.cloudera.cmf.db.name=scm
com.cloudera.cmf.db.user=scm
com.cloudera.cmf.db.setupType=EXTERNAL
com.cloudera.cmf.db.password=scm
```
